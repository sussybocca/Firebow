<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Firebow Platform</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>üî• Firebow ‚Äì Build & Deploy Websites</h1>
  </header>

  <div id="container">
    <div id="sidebar">
      <h2>Files</h2>
      <ul id="files"></ul>
      <button id="add-file">Add File</button>
      <button id="delete-file">Delete File</button>
      <button id="rename-file">Rename File</button>
      <button id="save-file">Save File</button>

      <hr />

      <button id="deploy">üöÄ Deploy to Netlify</button>
      <input type="password" id="netlify-token" placeholder="Enter Netlify Access Token">
      <div id="deploy-status"></div>
    </div>

    <div id="editor-preview">
      <textarea id="editor" placeholder="Start coding..."></textarea>
      <iframe id="preview-frame"></iframe>
    </div>
  </div>

  <!-- JSZip (optional if you compress projects) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <!-- Main Firebow logic -->
  <script src="script.js"></script>

  <!-- Netlify deploy integration -->
  <script>
  // Frontend-only Firebow deploy integration
  async function deployToNetlify(files, siteName) {
    const token = document.getElementById("netlify-token").value.trim();
    const status = document.getElementById("deploy-status");

    if (!token) {
      status.textContent = "‚ö†Ô∏è Please enter your Netlify Access Token.";
      return;
    }

    status.textContent = "üõ†Ô∏è Creating site and uploading files...";

    try {
      // 1Ô∏è‚É£ Create a new site
      const siteResp = await fetch("https://api.netlify.com/api/v1/sites", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          name: siteName || `firebow-${Math.random().toString(36).slice(2,8)}`
        })
      });

      const siteData = await siteResp.json();
      if (!siteResp.ok) throw new Error(siteData.message);
      const siteId = siteData.site_id;
      const deployUrl = siteData.ssl_url || siteData.url;

      // 2Ô∏è‚É£ Upload project files
      for (const [path, content] of Object.entries(files)) {
        const upload = await fetch(`https://api.netlify.com/api/v1/sites/${siteId}/files/${path}`, {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "text/plain"
          },
          body: content
        });
        if (!upload.ok) throw new Error(`Upload failed for ${path}`);
      }

      status.innerHTML = `‚úÖ Deployed successfully! <a href="${deployUrl}" target="_blank">${deployUrl}</a>`;
    } catch (err) {
      status.textContent = `‚ùå Deployment error: ${err.message}`;
    }
  }

  // Connect "Deploy" button
  document.getElementById("deploy").addEventListener("click", async () => {
    // Gather project files from the Firebow editor
    const editor = document.getElementById("editor");
    const htmlContent = editor.value || "<h1>Hello from Firebow!</h1>";

    // Default project template
    const files = {
      "index.html": `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebow Project</title>
</head>
<body>
  ${htmlContent}
</body>
</html>`
    };

    await deployToNetlify(files, "firebow-project");
  });
  </script>
</body>
</html>